<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>GelfAppenderFactory.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Dropwizard GELF Bundle</a> &gt; <a href="index.source.html" class="el_package">net.gini.dropwizard.gelf.logging</a> &gt; <span class="el_source">GelfAppenderFactory.java</span></div><h1>GelfAppenderFactory.java</h1><pre class="source lang-java linenums">package net.gini.dropwizard.gelf.logging;

import ch.qos.logback.classic.Level;
import ch.qos.logback.classic.LoggerContext;
import ch.qos.logback.classic.spi.ILoggingEvent;
import ch.qos.logback.core.Appender;
import ch.qos.logback.core.Layout;
import com.fasterxml.jackson.annotation.JsonProperty;
import com.fasterxml.jackson.annotation.JsonTypeName;
import com.google.common.base.Optional;
import com.google.common.collect.ImmutableMap;
import io.dropwizard.logging.AbstractAppenderFactory;
import io.dropwizard.validation.PortRange;
import me.moocar.logbackgelf.GelfAppender;
import org.hibernate.validator.constraints.NotEmpty;
import org.hibernate.validator.valuehandling.UnwrapValidatedValue;

import javax.validation.constraints.Min;
import javax.validation.constraints.NotNull;
import javax.validation.constraints.Pattern;

import static com.google.common.base.Preconditions.checkNotNull;

@JsonTypeName(&quot;gelf&quot;)
<span class="fc" id="L25">public class GelfAppenderFactory extends AbstractAppenderFactory {</span>

<span class="fc" id="L27">    @JsonProperty</span>
    @NotNull
    private Level threshold = Level.ALL;

<span class="fc" id="L31">    @JsonProperty</span>
    @NotNull
    @UnwrapValidatedValue
<span class="fc" id="L34">    private Optional&lt;String&gt; facility = Optional.absent();</span>

<span class="fc" id="L36">    @JsonProperty</span>
    @NotEmpty
    private String host = &quot;localhost&quot;;

<span class="fc" id="L40">    @JsonProperty</span>
    @PortRange(min = 1)
    private int port = 12201;

<span class="fc" id="L44">    @JsonProperty</span>
    @NotNull
    @UnwrapValidatedValue
<span class="fc" id="L47">    private Optional&lt;String&gt; hostName = Optional.absent();</span>

<span class="fc" id="L49">    @JsonProperty</span>
    private boolean useLoggerName = true;

<span class="fc" id="L52">    @JsonProperty</span>
    private boolean useThreadName = true;

<span class="fc" id="L55">    @JsonProperty</span>
    @NotEmpty
    @Pattern(regexp = &quot;0\\.9\\.[56]&quot;)
    private String serverVersion = &quot;0.9.6&quot;;

<span class="fc" id="L60">    @JsonProperty</span>
    @Min(0)
    private int chunkThreshold = 1000;

<span class="fc" id="L64">    @JsonProperty</span>
    private String messagePattern = &quot;%m%rEx&quot;;

<span class="fc" id="L67">    @JsonProperty</span>
    private String shortMessagePattern = null;

<span class="fc" id="L70">    @JsonProperty</span>
    @NotNull
<span class="fc" id="L72">    private ImmutableMap&lt;String, String&gt; additionalFields = ImmutableMap.of();</span>

<span class="fc" id="L74">    @JsonProperty</span>
    @NotNull
<span class="fc" id="L76">    private ImmutableMap&lt;String, String&gt; staticFields = ImmutableMap.of();</span>

<span class="fc" id="L78">    @JsonProperty</span>
    @NotNull
<span class="fc" id="L80">    private ImmutableMap&lt;String, String&gt; fieldTypes = ImmutableMap.of();</span>

<span class="fc" id="L82">    @JsonProperty</span>
    private boolean includeFullMDC = false;

<span class="fc" id="L85">    @JsonProperty</span>
    private boolean useMarker = false;

    public Level getThreshold() {
<span class="nc" id="L89">        return threshold;</span>
    }

    public void setThreshold(Level threshold) {
<span class="nc" id="L93">        this.threshold = threshold;</span>
<span class="nc" id="L94">    }</span>

    public Optional&lt;String&gt; getFacility() {
<span class="fc" id="L97">        return facility;</span>
    }

    public void setFacility(Optional&lt;String&gt; facility) {
<span class="nc" id="L101">        this.facility = facility;</span>
<span class="nc" id="L102">    }</span>

    public String getHost() {
<span class="fc" id="L105">        return host;</span>
    }

    public void setHost(String host) {
<span class="nc" id="L109">        this.host = host;</span>
<span class="nc" id="L110">    }</span>

    public int getPort() {
<span class="fc" id="L113">        return port;</span>
    }

    public void setPort(int port) {
<span class="nc" id="L117">        this.port = port;</span>
<span class="nc" id="L118">    }</span>

    public Optional&lt;String&gt; getHostName() {
<span class="fc" id="L121">        return hostName;</span>
    }

    public void setHostName(Optional&lt;String&gt; hostName) {
<span class="nc" id="L125">        this.hostName = hostName;</span>
<span class="nc" id="L126">    }</span>

    public boolean isUseLoggerName() {
<span class="nc" id="L129">        return useLoggerName;</span>
    }

    public void setUseLoggerName(boolean useLoggerName) {
<span class="nc" id="L133">        this.useLoggerName = useLoggerName;</span>
<span class="nc" id="L134">    }</span>

    public boolean isUseThreadName() {
<span class="nc" id="L137">        return useThreadName;</span>
    }

    public void setUseThreadName(boolean useThreadName) {
<span class="nc" id="L141">        this.useThreadName = useThreadName;</span>
<span class="nc" id="L142">    }</span>

    public String getServerVersion() {
<span class="fc" id="L145">        return serverVersion;</span>
    }

    public void setServerVersion(String serverVersion) {
<span class="nc" id="L149">        this.serverVersion = serverVersion;</span>
<span class="nc" id="L150">    }</span>

    public int getChunkThreshold() {
<span class="fc" id="L153">        return chunkThreshold;</span>
    }

    public void setChunkThreshold(int chunkThreshold) {
<span class="nc" id="L157">        this.chunkThreshold = chunkThreshold;</span>
<span class="nc" id="L158">    }</span>

    public String getMessagePattern() {
<span class="fc" id="L161">        return messagePattern;</span>
    }

    public void setMessagePattern(String messagePattern) {
<span class="nc" id="L165">        this.messagePattern = messagePattern;</span>
<span class="nc" id="L166">    }</span>

    public String getShortMessagePattern() {
<span class="fc" id="L169">        return shortMessagePattern;</span>
    }

    public void setShortMessagePattern(String shortMessagePattern) {
<span class="nc" id="L173">        this.shortMessagePattern = shortMessagePattern;</span>
<span class="nc" id="L174">    }</span>

    public ImmutableMap&lt;String, String&gt; getAdditionalFields() {
<span class="fc" id="L177">        return additionalFields;</span>
    }

    public void setAdditionalFields(ImmutableMap&lt;String, String&gt; additionalFields) {
<span class="nc" id="L181">        this.additionalFields = additionalFields;</span>
<span class="nc" id="L182">    }</span>

    public ImmutableMap&lt;String, String&gt; getStaticFields() {
<span class="fc" id="L185">        return staticFields;</span>
    }

    public void setStaticFields(ImmutableMap&lt;String, String&gt; staticFields) {
<span class="nc" id="L189">        this.staticFields = staticFields;</span>
<span class="nc" id="L190">    }</span>

    public ImmutableMap&lt;String, String&gt; getFieldTypes() {
<span class="fc" id="L193">        return fieldTypes;</span>
    }

    public void setFieldTypes(ImmutableMap&lt;String, String&gt; fieldTypes) {
<span class="nc" id="L197">        this.fieldTypes = fieldTypes;</span>
<span class="nc" id="L198">    }</span>

    public boolean isIncludeFullMDC() {
<span class="nc" id="L201">        return includeFullMDC;</span>
    }

    public void setIncludeFullMDC(boolean includeFullMDC) {
<span class="nc" id="L205">        this.includeFullMDC = includeFullMDC;</span>
<span class="nc" id="L206">    }</span>

    public boolean isUseMarker() {
<span class="nc" id="L209">        return useMarker;</span>
    }

    public void setUseMarker(boolean useMarker) {
<span class="nc" id="L213">        this.useMarker = useMarker;</span>
<span class="nc" id="L214">    }</span>

    @Override
    public Appender&lt;ILoggingEvent&gt; build(LoggerContext context, String applicationName, Layout&lt;ILoggingEvent&gt; layout) {
<span class="fc" id="L218">        checkNotNull(context);</span>

<span class="fc" id="L220">        final GelfAppender appender = new GelfAppender();</span>

<span class="fc" id="L222">        appender.setContext(context);</span>
<span class="fc" id="L223">        appender.setFacility(facility.or(applicationName));</span>
<span class="fc" id="L224">        appender.setGraylog2ServerHost(host);</span>
<span class="fc" id="L225">        appender.setGraylog2ServerPort(port);</span>
<span class="fc" id="L226">        appender.setGraylog2ServerVersion(serverVersion);</span>
<span class="fc" id="L227">        appender.setMessagePattern(messagePattern);</span>
<span class="fc" id="L228">        appender.setShortMessagePattern(shortMessagePattern);</span>
<span class="fc" id="L229">        appender.setUseLoggerName(useLoggerName);</span>
<span class="fc" id="L230">        appender.setUseThreadName(useThreadName);</span>
<span class="fc" id="L231">        appender.setChunkThreshold(chunkThreshold);</span>
<span class="fc" id="L232">        appender.setAdditionalFields(additionalFields);</span>
<span class="fc" id="L233">        appender.setStaticAdditionalFields(staticFields);</span>
<span class="fc" id="L234">        appender.setFieldTypes(fieldTypes);</span>
<span class="fc" id="L235">        appender.setIncludeFullMDC(includeFullMDC);</span>
<span class="fc" id="L236">        appender.setUseMarker(useMarker);</span>

<span class="pc bpc" id="L238" title="1 of 2 branches missed.">        if(hostName.isPresent()) {</span>
<span class="nc" id="L239">            appender.setHostName(hostName.get());</span>
        }

<span class="fc" id="L242">        addThresholdFilter(appender, threshold);</span>
<span class="fc" id="L243">        appender.start();</span>

<span class="fc" id="L245">        return wrapAsync(appender);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span></div></body></html>